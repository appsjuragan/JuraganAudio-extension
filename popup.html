<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>JuraganAudio Toolkit</title>
  <link rel="stylesheet" type="text/css" href="popup.css" />
  <script src="snap.svg-min.js"></script>
  <script type="module" src="modules/main.js"></script>
</head>

<body>
  <!-- Radio Inputs for Tabs - Must be first for sibling selectors -->
  <input id="tab-1" type="radio" name="tab-group" checked="checked" />
  <input id="tab-2" type="radio" name="tab-group" />
  <input id="tab-3" type="radio" name="tab-group" />

  <div id="bottomControls">
    <div class="dashboard-grid">
      <!-- Left: Power & Reset -->
      <div class="dash-section power-section">
        <button id="eqTabButton" class="power-btn" title="Toggle EQ for this tab">
          <span class="power-icon">‚èª</span> EQ
        </button>
        <button id="resetFiltersButton" title="Reset all filters to flat">Reset</button>
      </div>

      <!-- Center: Preset Management -->
      <div class="dash-section preset-section">
        <select id="presetSelect" title="Select a preset">
          <option value="" disabled selected>Select preset</option>
        </select>
        <div class="preset-input-group">
          <input id="presetNameInput" type="text" placeholder="Preset Name" />
          <button id="savePresetButton" title="Save Preset">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
              <polyline points="17 21 17 13 7 13 7 21"></polyline>
              <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
          </button>
          <button id="deletePresetButton" title="Delete Preset">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              <line x1="10" y1="11" x2="10" y2="17"></line>
              <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
          </button>
        </div>
      </div>

      <!-- Right: Settings & I/O -->
      <div class="dash-section settings-section">
        <div class="settings-row">
          <select id="qualityModeSelect" title="Audio quality mode">
            <option value="efficient">Efficient</option>
            <option value="quality">Quality</option>
            <option value="hifi">Hi-Fi</option>
          </select>
          <button id="vizButton" title="Toggle Spectrum Visualizer">Visualizer</button>
        </div>
        <div class="settings-row">
          <select id="visualizerStyleSelect" title="Visualizer style">
            <option value="default">Default</option>
            <option value="fancy-line">Fancy Line</option>
            <option value="bars">Bars</option>
            <option value="dots">Dots</option>
            <option value="mirror-bars">Mirror Bars</option>
            <option value="mountain">Mountain</option>
          </select>
        </div>
        <div class="io-row">
          <button id="exportPresetsButton" title="Export Presets">Export</button>
          <button id="importPresetsButton" title="Import Presets">Import</button>
        </div>
      </div>
    </div>

    <!-- Hidden elements -->
    <div style="display:none;">
      <span id="userPresetSpan"></span>
      <button id="bassBoostButton">Bass Boost</button>
      <input type="file" id="importPresetsFile" />
    </div>
  </div>

  <h1>
    <span>JuraganAudio Toolkit</span>
    <div id="tabNav">
      <label id="label-1" for="tab-1">Controls</label>
      <label for="tab-2">Guide</label>
      <label for="tab-3">Active Tabs</label>
      <button id="themeToggle" title="Toggle Light/Dark Mode">üåì</button>
      <button id="settingsToggle" title="Settings">
        <img src="assets/cog.svg" width="16" height="16" alt="Settings">
      </button>
    </div>
  </h1>

  <div id="mainDiv">
    <!-- Inputs moved to body top -->

    <div id="eqDiv">
      <span id="limiterIndicator">LIM</span>
      <span id="sbrIndicator" title="Spectral Band Replication active - restoring high frequencies">SBR</span>
      <svg id="gainSvg" width="30" height="300"></svg>
      <div id="eqGraphContainer">
        <canvas id="visualizerCanvas" width="640" height="300"></canvas>
        <svg id="eqSvg" width="640" height="300"></svg>
      </div>
      <div id="eqOptionsDiv">
      </div>
    </div>
    <div id="guideDiv">
      <h3>üöÄ Getting Started</h3>
      <p>
        JuraganAudio works on a per-tab basis. Click the extension icon to activate audio processing for the current
        tab.
        Want to EQ multiple tabs? Just open them and click the icon on each one.
      </p>

      <h3>üéõÔ∏è Precision EQ</h3>
      <p>
        Take control with our interactive parametric equalizer:
      </p>
      <p>
        &bull; <strong>Shelf Filters (Purple):</strong> Best for broad bass or treble adjustments.<br>
        &bull; <strong>Notch Filters (Blue):</strong> Perfect for targeting specific frequencies.<br>
        &bull; <strong>Frequency (Left/Right):</strong> Slide to select the tone.<br>
        &bull; <strong>Gain (Up/Down):</strong> Boost the energy or cut the harshness.<br>
        &bull; <strong>Q-Factor (Shift + Drag):</strong> Adjust the width of the filter for surgical precision.
      </p>

      <h3>üåà Visual Insight</h3>
      <p>
        The real-time spectrum visualizer shows your audio's DNA. Lower sounds are on the left, higher sounds on the
        right.
        Watch how your EQ curve carves the sound in real-time.
        <a href="https://www.youtube.com/watch?v=VMnkYTan5pY" rel="noopener noreferrer" target="_blank">Watch the
          demo</a>.
      </p>

      <h3>üíé Advanced Tech</h3>
      <p>
        &bull; <strong>SBR (Spectral Band Replication):</strong> Restores high-frequency detail for a "crisp" and airy
        sound.
        Look for the <strong>SBR</strong> indicator.<br>
        &bull; <strong>Limiter (LIM):</strong> Prevents digital distortion. If the <strong>LIM</strong> indicator glows,
        JuraganAudio
        is protecting your ears and speakers.<br>
        &bull; <strong>Quality Modes:</strong> Choose <strong>Efficient</strong> for battery saving or
        <strong>Hi-Fi</strong>
        for the highest fidelity processing.
      </p>

      <h3>üíæ Presets</h3>
      <p>
        Found your perfect sound? Type a name and click <strong>+</strong> to save it. High-quality audio is now just
        one click away.
      </p>

      <h3>
        Need a deep dive? Check out <a
          href="https://music.tutsplus.com/tutorials/how-to-use-a-parametric-equalizer--audio-2301"
          rel="noopener noreferrer" target="_blank">our EQ masterclass guide</a>.
      </h3>
    </div>
    <div id="tabsDiv">
      <div id="eqTabList"></div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>JuraganAudio Setting</h2>
      </div>
      <div class="modal-body">
        <!-- SBR Section -->
        <div class="setting-group">
          <div class="setting-row">
            <span class="setting-label">SBR (Spectral Band Replication)</span>
            <label class="switch">
              <input type="checkbox" id="sbrToggle">
              <span class="slider round"></span>
              <span class="switch-text on">ON</span>
              <span class="switch-text off">OFF</span>
            </label>
          </div>
          <div class="setting-row">
            <span class="setting-label">SBR Gain</span>
            <div class="range-container">
              <span class="range-min">0.5db</span>
              <input type="range" id="sbrGain" min="0.5" max="15" step="0.5" value="1">
              <span class="range-max">15db</span>
              <div class="range-value" id="sbrGainValue">1db</div>
            </div>
          </div>
        </div>

        <!-- Limiter Section -->
        <div class="setting-group">
          <div class="setting-row">
            <span class="setting-label">Limiter</span>
            <label class="switch">
              <input type="checkbox" id="limiterToggle">
              <span class="slider round"></span>
              <span class="switch-text on">ON</span>
              <span class="switch-text off">OFF</span>
            </label>
          </div>
          <div class="setting-row">
            <span class="setting-label">Limiter Attack time</span>
            <div class="range-container">
              <span class="range-min">10 ms</span>
              <input type="range" id="limiterAttack" min="10" max="1000" step="10" value="100">
              <span class="range-max">1000ms</span>
              <div class="range-value" id="limiterAttackValue">100ms</div>
            </div>
          </div>
          <div class="setting-row">
            <span class="setting-label">Limiter Threshold</span>
            <div class="range-container">
              <span class="range-min">0.70</span>
              <input type="range" id="limiterThreshold" min="0.7" max="1.0" step="0.01" value="0.95">
              <span class="range-max">1.00</span>
              <div class="range-value" id="limiterThresholdValue">0.95</div>
            </div>
          </div>
          <div class="setting-row">
            <span class="setting-label">Limiter Knee</span>
            <div class="range-container">
              <span class="range-min">0</span>
              <input type="range" id="limiterKnee" min="0" max="0.2" step="0.01" value="0.05">
              <span class="range-max">0.20</span>
              <div class="range-value" id="limiterKneeValue">0.05</div>
            </div>
          </div>
          <div class="setting-row">
            <span class="setting-label">Limiter Lookahead</span>
            <div class="range-container">
              <span class="range-min">0 ms</span>
              <input type="range" id="limiterLookahead" min="0" max="5" step="0.5" value="2">
              <span class="range-max">5 ms</span>
              <div class="range-value" id="limiterLookaheadValue">2ms</div>
            </div>
          </div>
          <div class="setting-row">
            <span class="setting-label">Limiter Detector</span>
            <div class="select-container">
              <select id="limiterDetectorMode">
                <option value="peak">Peak</option>
                <option value="rms">RMS</option>
              </select>
            </div>
          </div>
          <div class="setting-row">
            <span class="setting-label">Limiter RMS Window</span>
            <div class="range-container">
              <span class="range-min">10 ms</span>
              <input type="range" id="limiterRmsTime" min="10" max="200" step="10" value="50">
              <span class="range-max">200 ms</span>
              <div class="range-value" id="limiterRmsTimeValue">50ms</div>
            </div>
          </div>
        </div>

        <!-- Visualizer FPS Section -->
        <div class="setting-group">
          <div class="setting-row">
            <span class="setting-label">Visualizer FPS</span>
            <div class="range-container">
              <span class="range-min">15 fps</span>
              <input type="range" id="visualizerFps" min="15" max="120" step="5" value="30">
              <span class="range-max">120 fps</span>
              <div class="range-value" id="visualizerFpsValue">30 fps</div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="settingsFullResetBtn" class="modal-btn danger" style="margin-right: auto;">FULL RESET</button>
        <button id="settingsDefaultBtn" class="modal-btn secondary">Default</button>
        <button id="settingsOkBtn" class="modal-btn primary">OK</button>
      </div>
    </div>
  </div>

  <div id="toast"></div>
</body>

</html>
